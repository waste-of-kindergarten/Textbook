<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>模块、包和项目 &mdash; TextBook v0.1 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dark_mode_css/general.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dark_mode_css/dark.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/translations.js"></script>
        <script src="../../../_static/dark_mode_js/default_dark.js"></script>
        <script src="../../../_static/dark_mode_js/theme_switcher.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="资源" href="../../%E8%B5%84%E6%BA%90.html" />
    <link rel="prev" title="Haskell 工程专题" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            TextBook
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Haskell TextBook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Haskell%20%E5%AE%89%E8%A3%85%E4%B8%8E%E5%85%A5%E9%97%A8.html">Haskell 安装与入门</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%87%BD%E6%95%B0.html">数据类型与函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E8%A1%A8%E8%BE%BE%E5%BC%8F.html">表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E9%80%92%E5%BD%92%E4%B8%8E%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0.html">递归与高阶函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%B1%BB%E5%9E%8B%E7%B1%BB.html">类型类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../%E5%87%BD%E5%AD%90%E4%B8%93%E9%A2%98.html">函子专题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Monad%E4%B8%93%E9%A2%98.html">Monad专题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../IO%20%E4%B8%93%E9%A2%98.html">IO 专题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Haskell%20%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F.html">Haskell 的类型系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Typeable%20%E4%B8%93%E9%A2%98.html">Typeable 专题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GADTs%20%E4%B8%93%E9%A2%98.html">GADTs 专题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Generics%20%E4%B8%93%E9%A2%98.html">Generics 专题</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Haskell 工程专题</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">模块、包和项目</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">使用模块组织代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">包</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">从零创建一个简单的项目</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">项目的打包与安装</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../%E8%B5%84%E6%BA%90.html">资源</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TextBook</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Haskell TextBook</a></li>
          <li class="breadcrumb-item"><a href="index.html">Haskell 工程专题</a></li>
      <li class="breadcrumb-item active">模块、包和项目</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/haskell/专题/工程专题/模块、包和项目.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>模块、包和项目<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h1>
<section id="id2">
<h2>使用模块组织代码<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<p>每一个Haskell应用都是一组模块的集合，每一个模块都可以导入来自其他模块、基础库以及其他库的定义；除此之外，模块还可以到处一些定义，这些定义对于其他模块将变得可见（可以被其他模块导入）。在众多模块中有一个特殊的模块<code class="docutils literal notranslate"><span class="pre">Main</span></code>，该模块作为程序进入点，有且仅有一个。</p>
<section id="id3">
<h3>模块介绍<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h3>
<p>一个Haskell模块的结构如下：</p>
<div class="highlight-hs notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">ModuleName</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="nf">export</span><span class="w"> </span><span class="nf">list</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span>

<span class="c1">-- set of imports </span>

<span class="c1">-- declarations for main codes such as </span>
<span class="c1">-- + data types and type synonyms</span>
<span class="c1">-- + type classes and instances</span>
<span class="c1">-- + functions </span>
<span class="c1">-- etc</span>
</pre></div>
</div>
<p>其中模块名称<code class="docutils literal notranslate"><span class="pre">ModuleName</span></code>首字母必须大写，且建议与文件名称一致。</p>
<p>对于导入模块：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">SomeModule</span></code> 可以导入整个模块</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">SomeModule(name1,name2,...)</span></code> 可以导入模块中指定的名字</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">SomeModule()</span></code> 不导入模块的任何名字，不具有名字的实例除外</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">qualified</span> <span class="pre">SomeModule</span></code>导入整个模块但保留完整前缀，<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">qualified</span> <span class="pre">SomeModule(name1,name2,...)</span></code>导入指定名字但保留完成前缀；这意味我们必须使用<code class="docutils literal notranslate"><span class="pre">SomeModule.name1</span></code>对<code class="docutils literal notranslate"><span class="pre">name1</span></code>进行调用</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">qualified</span> <span class="pre">SomeModule</span> <span class="pre">as</span> <span class="pre">Alias</span></code>导入整个模块并使用别名<code class="docutils literal notranslate"><span class="pre">Alias</span></code>；这意味我们必须使用<code class="docutils literal notranslate"><span class="pre">Alias.name1</span></code>对<code class="docutils literal notranslate"><span class="pre">name1</span></code>调用，而非<code class="docutils literal notranslate"><span class="pre">SomeModule.name1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">SomeModule</span> <span class="pre">hiding</span> <span class="pre">(name1,name2,...)</span></code> 导入整个模块除了<code class="docutils literal notranslate"><span class="pre">name1</span></code>、<code class="docutils literal notranslate"><span class="pre">name2</span></code>等</p></li>
</ul>
<p>对于导出列表<code class="docutils literal notranslate"><span class="pre">&lt;export</span> <span class="pre">list&gt;</span></code>来说：</p>
<ul class="simple">
<li><p>可以导出函数的名称</p></li>
<li><p>可以导出数据类型（使用<code class="docutils literal notranslate"><span class="pre">(..)</span></code>跟随类型构造器，可包含值（全部或部分）构造器）</p></li>
<li><p>类型类的名称（使用<code class="docutils literal notranslate"><span class="pre">(..)</span></code>跟随类型类名称，可包含（全部或部分）内部方法）</p></li>
<li><p>已经导入的模块的名称或同义词</p></li>
</ul>
<p>例如：</p>
<div class="highlight-hs notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">ModuleName</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nf">module</span><span class="w"> </span><span class="kt">X</span><span class="p">,</span>
<span class="w">    </span><span class="nf">module</span><span class="w"> </span><span class="kt">Y</span><span class="p">,</span>
<span class="w">    </span><span class="kt">DataType1</span><span class="p">,</span>
<span class="w">    </span><span class="kt">DataType2</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span>
<span class="w">    </span><span class="kt">DataType3</span><span class="w"> </span><span class="p">(</span><span class="kt">Cons1</span><span class="p">,</span><span class="w"> </span><span class="kt">Cons2</span><span class="p">),</span>
<span class="w">    </span><span class="kt">TypeClass1</span><span class="p">,</span>
<span class="w">    </span><span class="kt">TypeClass2</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span>
<span class="w">    </span><span class="kt">TypeClass3</span><span class="w"> </span><span class="p">(</span><span class="nf">method1</span><span class="p">,</span><span class="nf">method2</span><span class="p">),</span>
<span class="w">    </span><span class="nf">fun1</span><span class="p">,</span><span class="w"> </span><span class="nf">fun2</span><span class="p">,</span><span class="w"> </span><span class="nf">fun3</span>
<span class="p">)</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span>

<span class="kr">import</span><span class="w"> </span><span class="nn">X</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">SomeModule</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span>
</pre></div>
</div>
<p>使用以上的导出，当我们在其他模块中导入该模块时，可以使用的是：</p>
<ul class="simple">
<li><p>模块X和模块Y中导出的任何内容</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataType1</span></code> 类型构造器，但我们无法进行模式匹配或构造该类型的值</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataType2</span></code> 类型构造器以及内部所有的值构造器</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataType3</span></code> 类型构造器以及内部的两个构造器<code class="docutils literal notranslate"><span class="pre">Con1</span></code>和<code class="docutils literal notranslate"><span class="pre">Con2</span></code>，如果另有构造器<code class="docutils literal notranslate"><span class="pre">Con3</span></code>则该构造器无法被使用</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TypeClass1</span></code> 类型类，内部方法无法使用</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TypeClass2</span></code> 类型类，内部方法只有<code class="docutils literal notranslate"><span class="pre">method1</span></code>和<code class="docutils literal notranslate"><span class="pre">method2</span></code>可以被使用</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TypeClass3</span></code>类型类以及全部方法均可以被使用</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fun1</span></code>、<code class="docutils literal notranslate"><span class="pre">fun2</span></code>、<code class="docutils literal notranslate"><span class="pre">fun3</span></code>三个函数</p></li>
</ul>
<blockquote>
<div><p>补充：<code class="docutils literal notranslate"><span class="pre">&lt;export</span> <span class="pre">list&gt;</span></code>并不是必须的，我们可以声明<code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">ModuleName</span> <span class="pre">where</span></code>以便模块可以全部导出；但通常情况下，除非模块内容非常少，否则不建议这样做</p>
</div></blockquote>
</section>
<section id="id4">
<h3>模块层次<a class="headerlink" href="#id4" title="此标题的永久链接"></a></h3>
<p>模块名称具有层次的，可以使用<code class="docutils literal notranslate"><span class="pre">.</span></code>对元素进行分隔，如<code class="docutils literal notranslate"><span class="pre">Data.Typeable</span></code>。一般地，模块层次及其名称有如下对应关系：</p>
<center><p><img alt="../../../_images/module.png" src="../../../_images/module.png" /></p>
</center></section>
</section>
<section id="id5">
<h2>包<a class="headerlink" href="#id5" title="此标题的永久链接"></a></h2>
<p>一个 <em><strong>包(package)</strong></em> 可以认为由两部分组成：</p>
<ol class="simple">
<li><p>对每个导出模块的接口文件</p></li>
</ol>
<p>2  编译过的（静态或者动态）库文件</p>
<p>当编译器编译程序时，首先读取源文件导入的模块名称，接着在包数据库中查找哪些包提供了需要的模块以及对应的构建在文件系统的位置；然后编译器查找这些模块的接口文件并使用文件中的信息编译模块，在链接阶段，会查找由这些包提供的静态或者动态库；最后编译器链接所有的静态或动态库得到可执行文件或库。</p>
<p><code class="docutils literal notranslate"><span class="pre">ghc-pkg</span></code>命令用于查找数据库中包的信息，我们可以使用<code class="docutils literal notranslate"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code>查看当前注册的所有包的名称和版本；<code class="docutils literal notranslate"><span class="pre">ghc-pkg</span> <span class="pre">describe</span> <span class="pre">...</span></code>命令可以进一步查看某个包更详细的信息；或者，我们还可以通过命令<code class="docutils literal notranslate"><span class="pre">ghc-pkg</span> <span class="pre">find-module</span> <span class="pre">...</span></code>查找某个模块所对应的包。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Prelude&gt;<span class="w"> </span>ghc-pkg<span class="w"> </span>list
/home/user/.ghcup/ghc/8.6.4/lib/ghc-8.6.4/package.conf.d
<span class="w">    </span>Cabal-2.4.0.1
<span class="w">    </span>array-0.5.3.0
<span class="w">    </span>base-4.12.0.0
...
Prelude&gt;<span class="w"> </span>ghc-pkg<span class="w"> </span>describe<span class="w"> </span>base
name:<span class="w"> </span>base
version:<span class="w"> </span><span class="m">4</span>.12.0.0
id:<span class="w"> </span>base-4.12.0.0
key:<span class="w"> </span>base-4.12.0.0
license:<span class="w"> </span>BSD-3-Clause
maintainer:<span class="w"> </span>libraries@haskell.org
...
Prelude&gt;<span class="w"> </span>ghc-pkg<span class="w"> </span>find-module<span class="w"> </span>Data.Typeable
/home/user/.ghcup/ghc/8.6.4/lib/ghc-8.6.4/package.conf.d
<span class="w">    </span>base-4.12.0.0
</pre></div>
</div>
<blockquote>
<div><p>提示： <code class="docutils literal notranslate"><span class="pre">ghc-pkg</span></code>命令查找的是GHC的全局数据库，除了将包安装到全局，我们还可以使用项目管理工具，为某个项目设置单独的环境，将需要的包安装到相应的项目上。</p>
</div></blockquote>
<section id="cabal">
<h3>包管理工具Cabal<a class="headerlink" href="#cabal" title="此标题的永久链接"></a></h3>
<p>Cabal库定义了Haskell包的信息并提供了操作包的工具（包括但不限于获取包的信息、构建包、注册包）。</p>
<p>Cabal包中有两个至关重要的文件，其中之一以<code class="docutils literal notranslate"><span class="pre">.cabal</span></code>后缀结尾，该文件定义了包内详细的描述信息；另外一个为<code class="docutils literal notranslate"><span class="pre">Setup.hs</span></code>文件，其为但文件程序，用于执行各种设置任务，该文件内容由<code class="docutils literal notranslate"><span class="pre">.cabal</span></code>文件中的生成类型设置确定，一般情况下我们只需交给Cabal生成该文件即可。</p>
<p>对于一个<code class="docutils literal notranslate"><span class="pre">.cabal</span></code>文件来说，其包含：</p>
<ul class="simple">
<li><p>被其他包调用模块的库组件</p></li>
<li><p>任意多个可执行组件</p></li>
<li><p><em><strong>测试套件(test suites)</strong></em></p></li>
<li><p><em><strong>基准测试套件(benchmark suites)</strong></em></p></li>
<li><p>由主程序库，可执行组件库，测试套件和基准测试套件共享的内部库</p></li>
</ul>
<p>下面给出<a class="reference external" href="https://cabal.readthedocs.io/en/latest/cabal-package-description-file.html">官网</a>几个示例:</p>
<ul class="simple">
<li><p>包含简单库的包(HUnit package)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cabal</span><span class="o">-</span><span class="n">version</span><span class="p">:</span>  <span class="mf">3.0</span>
<span class="n">name</span><span class="p">:</span>           <span class="n">HUnit</span>
<span class="n">version</span><span class="p">:</span>        <span class="mf">1.1.1</span>
<span class="n">synopsis</span><span class="p">:</span>       <span class="n">A</span> <span class="n">unit</span> <span class="n">testing</span> <span class="n">framework</span> <span class="k">for</span> <span class="n">Haskell</span>
<span class="n">homepage</span><span class="p">:</span>       <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">hunit</span><span class="o">.</span><span class="n">sourceforge</span><span class="o">.</span><span class="n">net</span><span class="o">/</span>
<span class="n">category</span><span class="p">:</span>       <span class="n">Testing</span>
<span class="n">author</span><span class="p">:</span>         <span class="n">Dean</span> <span class="n">Herington</span>
<span class="n">license</span><span class="p">:</span>        <span class="n">BSD</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">Clause</span>
<span class="n">license</span><span class="o">-</span><span class="n">file</span><span class="p">:</span>   <span class="n">LICENSE</span>
<span class="n">build</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span>     <span class="n">Simple</span>

<span class="n">library</span>
  <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="p">:</span>      <span class="n">base</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mi">4</span>
  <span class="n">exposed</span><span class="o">-</span><span class="n">modules</span><span class="p">:</span>    <span class="n">Test</span><span class="o">.</span><span class="n">HUnit</span><span class="o">.</span><span class="n">Base</span><span class="p">,</span> <span class="n">Test</span><span class="o">.</span><span class="n">HUnit</span><span class="o">.</span><span class="n">Lang</span><span class="p">,</span>
                      <span class="n">Test</span><span class="o">.</span><span class="n">HUnit</span><span class="o">.</span><span class="n">Terminal</span><span class="p">,</span> <span class="n">Test</span><span class="o">.</span><span class="n">HUnit</span><span class="o">.</span><span class="n">Text</span><span class="p">,</span> <span class="n">Test</span><span class="o">.</span><span class="n">HUnit</span>
  <span class="n">default</span><span class="o">-</span><span class="n">extensions</span><span class="p">:</span> <span class="n">CPP</span>
  <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span>   <span class="n">Haskell2010</span>
</pre></div>
</div>
<ul class="simple">
<li><p>包含可执行程序的包</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cabal</span><span class="o">-</span><span class="n">version</span><span class="p">:</span>  <span class="mf">3.0</span>
<span class="n">name</span><span class="p">:</span>           <span class="n">TestPackage</span>
<span class="n">version</span><span class="p">:</span>        <span class="mf">0.0</span>
<span class="n">synopsis</span><span class="p">:</span>       <span class="n">Small</span> <span class="n">package</span> <span class="k">with</span> <span class="n">two</span> <span class="n">programs</span>
<span class="n">author</span><span class="p">:</span>         <span class="n">Angela</span> <span class="n">Author</span>
<span class="n">license</span><span class="p">:</span>        <span class="n">BSD</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">Clause</span>
<span class="n">build</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span>     <span class="n">Simple</span>

<span class="n">executable</span> <span class="n">program1</span>
  <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="p">:</span>    <span class="n">HUnit</span> <span class="o">&gt;=</span> <span class="mf">1.1.1</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mf">1.2</span>
  <span class="n">main</span><span class="o">-</span><span class="ow">is</span><span class="p">:</span>          <span class="n">main</span><span class="o">.</span><span class="n">hs</span>
  <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="p">:</span>   <span class="n">prog1</span>
  <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span> <span class="n">Haskell2010</span>

<span class="n">executable</span> <span class="n">program2</span>
  <span class="o">--</span> <span class="n">A</span> <span class="n">different</span> <span class="n">main</span><span class="o">.</span><span class="n">hs</span> <span class="n">because</span> <span class="n">of</span> <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="o">.</span>
  <span class="n">main</span><span class="o">-</span><span class="ow">is</span><span class="p">:</span>          <span class="n">main</span><span class="o">.</span><span class="n">hs</span>
  <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="p">:</span>    <span class="n">HUnit</span> <span class="o">&gt;=</span> <span class="mf">1.1.1</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mf">1.2</span>
  <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="p">:</span>   <span class="n">prog2</span>
  <span class="n">other</span><span class="o">-</span><span class="n">modules</span><span class="p">:</span>    <span class="n">Utils</span>
  <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span> <span class="n">Haskell2010</span>
</pre></div>
</div>
<ul class="simple">
<li><p>包含库和可执行程序</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cabal</span><span class="o">-</span><span class="n">version</span><span class="p">:</span>   <span class="mf">3.0</span>
<span class="n">name</span><span class="p">:</span>            <span class="n">TestPackage</span>
<span class="n">version</span><span class="p">:</span>         <span class="mf">0.0</span>
<span class="n">synopsis</span><span class="p">:</span>        <span class="n">Package</span> <span class="k">with</span> <span class="n">library</span> <span class="ow">and</span> <span class="n">two</span> <span class="n">programs</span>
<span class="n">license</span><span class="p">:</span>         <span class="n">BSD</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">Clause</span>
<span class="n">author</span><span class="p">:</span>          <span class="n">Angela</span> <span class="n">Author</span>
<span class="n">build</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span>      <span class="n">Simple</span>

<span class="n">library</span>
  <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="p">:</span>    <span class="n">HUnit</span> <span class="o">&gt;=</span> <span class="mf">1.1.1</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mf">1.2</span>
  <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="p">:</span>   <span class="n">lib</span>
  <span class="n">exposed</span><span class="o">-</span><span class="n">modules</span><span class="p">:</span>  <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span>
  <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span> <span class="n">Haskell2010</span>

<span class="n">executable</span> <span class="n">program1</span>
  <span class="n">main</span><span class="o">-</span><span class="ow">is</span><span class="p">:</span>          <span class="n">main</span><span class="o">.</span><span class="n">hs</span>
  <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="p">:</span>   <span class="n">prog1</span>
  <span class="n">other</span><span class="o">-</span><span class="n">modules</span><span class="p">:</span>    <span class="n">D</span><span class="p">,</span> <span class="n">E</span>
  <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span> <span class="n">Haskell2010</span>

<span class="n">executable</span> <span class="n">program2</span>
  <span class="o">--</span> <span class="n">A</span> <span class="n">different</span> <span class="n">main</span><span class="o">.</span><span class="n">hs</span> <span class="n">because</span> <span class="n">of</span> <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="o">.</span>
  <span class="n">main</span><span class="o">-</span><span class="ow">is</span><span class="p">:</span>          <span class="n">main</span><span class="o">.</span><span class="n">hs</span>
  <span class="o">--</span> <span class="n">No</span> <span class="n">bound</span> <span class="n">on</span> <span class="n">a</span> <span class="n">library</span> <span class="n">provided</span> <span class="n">by</span> <span class="n">the</span> <span class="n">same</span> <span class="n">package</span><span class="o">.</span>
  <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="p">:</span>    <span class="n">TestPackage</span>
  <span class="n">hs</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">dirs</span><span class="p">:</span>   <span class="n">prog2</span>
  <span class="n">other</span><span class="o">-</span><span class="n">modules</span><span class="p">:</span>    <span class="n">Utils</span>
  <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span> <span class="n">Haskell2010</span>
</pre></div>
</div>
<ul class="simple">
<li><p>包含测试套件</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cabal</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span>  <span class="mf">3.0</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">bar</span>
<span class="n">Version</span><span class="p">:</span>        <span class="mf">1.0</span>
<span class="n">License</span><span class="p">:</span>        <span class="n">BSD</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">Clause</span>
<span class="n">Build</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span>     <span class="n">Simple</span>

<span class="n">Test</span><span class="o">-</span><span class="n">Suite</span> <span class="n">test</span><span class="o">-</span><span class="n">bar</span>
    <span class="nb">type</span><span class="p">:</span>             <span class="n">detailed</span><span class="o">-</span><span class="mf">0.9</span>
    <span class="n">test</span><span class="o">-</span><span class="n">module</span><span class="p">:</span>      <span class="n">Bar</span>
    <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="p">:</span>    <span class="n">base</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Cabal</span> <span class="o">&gt;=</span> <span class="mf">1.9.2</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span> <span class="n">Haskell2010</span>
</pre></div>
</div>
<ul class="simple">
<li><p>包含基准测试套件</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cabal</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span>  <span class="mf">3.0</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">foo</span>
<span class="n">Version</span><span class="p">:</span>        <span class="mf">1.0</span>
<span class="n">License</span><span class="p">:</span>        <span class="n">BSD</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">Clause</span>
<span class="n">Build</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span>     <span class="n">Simple</span>

<span class="n">Benchmark</span> <span class="n">bench</span><span class="o">-</span><span class="n">foo</span>
    <span class="nb">type</span><span class="p">:</span>             <span class="n">exitcode</span><span class="o">-</span><span class="n">stdio</span><span class="o">-</span><span class="mf">1.0</span>
    <span class="n">main</span><span class="o">-</span><span class="ow">is</span><span class="p">:</span>          <span class="n">bench</span><span class="o">-</span><span class="n">foo</span><span class="o">.</span><span class="n">hs</span>
    <span class="n">build</span><span class="o">-</span><span class="n">depends</span><span class="p">:</span>    <span class="n">base</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="mf">1.1</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span> <span class="mf">1.7</span>
    <span class="n">default</span><span class="o">-</span><span class="n">language</span><span class="p">:</span> <span class="n">Haskell2010</span>
</pre></div>
</div>
<p>有关参数的细致说明，读者可以移步<a class="reference external" href="https://cabal.readthedocs.io/en/latest/cabal-package-description-file.html">官网</a>按需查询，限于篇幅这里不再赘述。</p>
</section>
</section>
<section id="id6">
<h2>从零创建一个简单的项目<a class="headerlink" href="#id6" title="此标题的永久链接"></a></h2>
<blockquote>
<div><p>提示： 不同的Cabal版本构建项目过程不尽相同，但原理基本一致</p>
</div></blockquote>
<p>本节将提供一个简单且完整的可执行项目示例，该项目功能未读取用户输入的数字，并输出对应的阶乘结果。</p>
<p>首先，使用<code class="docutils literal notranslate"><span class="pre">Cabal</span></code>管理工具初始化项目<code class="docutils literal notranslate"><span class="pre">cabal</span> <span class="pre">init</span></code>，这里为了便于读者了解创建过程，使用交互模式初始化<code class="docutils literal notranslate"><span class="pre">cabal</span> <span class="pre">init</span> <span class="pre">--interactive</span></code>。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>myproject
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>myproject
$<span class="w"> </span>cabal<span class="w"> </span>init<span class="w"> </span>--interactive
Should<span class="w"> </span>I<span class="w"> </span>generate<span class="w"> </span>a<span class="w"> </span>simple<span class="w"> </span>project<span class="w"> </span>with<span class="w"> </span>sensible<span class="w"> </span>defaults?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>y<span class="o">]</span><span class="w"> </span>n
What<span class="w"> </span>does<span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>build:
<span class="w">   </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>Executable
<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>Library
<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>Library<span class="w"> </span>and<span class="w"> </span>Executable
Your<span class="w"> </span>choice?<span class="w"> </span><span class="m">1</span>
What<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>main<span class="w"> </span>module<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>executable:
<span class="w"> </span>*<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>Main.hs<span class="w"> </span><span class="o">(</span>does<span class="w"> </span>not<span class="w"> </span>yet<span class="w"> </span>exist,<span class="w"> </span>but<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>created<span class="o">)</span>
<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>Main.lhs<span class="w"> </span><span class="o">(</span>does<span class="w"> </span>not<span class="w"> </span>yet<span class="w"> </span>exist,<span class="w"> </span>but<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>created<span class="o">)</span>
<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>Other<span class="w"> </span><span class="o">(</span>specify<span class="o">)</span>
Your<span class="w"> </span>choice?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>Main.hs<span class="w"> </span><span class="o">(</span>does<span class="w"> </span>not<span class="w"> </span>yet<span class="w"> </span>exist,<span class="w"> </span>but<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>created<span class="o">)]</span><span class="w"> </span>
Please<span class="w"> </span>choose<span class="w"> </span>version<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>Cabal<span class="w"> </span>specification<span class="w"> </span>to<span class="w"> </span>use:
<span class="w">   </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.10<span class="w">   </span><span class="o">(</span>legacy<span class="o">)</span>
<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="m">2</span>.0<span class="w">    </span><span class="o">(</span>+<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span>Backpack,<span class="w"> </span>internal<span class="w"> </span>sub-libs,<span class="w"> </span><span class="s1">&#39;^&gt;=&#39;</span><span class="w"> </span>operator<span class="o">)</span>
<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="m">2</span>.2<span class="w">    </span><span class="o">(</span>+<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;common&#39;</span>,<span class="w"> </span><span class="s1">&#39;elif&#39;</span>,<span class="w"> </span>redundant<span class="w"> </span>commas,<span class="w"> </span>SPDX<span class="o">)</span>
<span class="w"> </span>*<span class="w"> </span><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="m">2</span>.4<span class="w">    </span><span class="o">(</span>+<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;**&#39;</span><span class="w"> </span>globbing<span class="o">)</span>
<span class="w">   </span><span class="m">5</span><span class="o">)</span><span class="w"> </span><span class="m">3</span>.0<span class="w">    </span><span class="o">(</span>+<span class="w"> </span><span class="nb">set</span><span class="w"> </span>notation<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">==</span>,<span class="w"> </span>common<span class="w"> </span>stanzas<span class="w"> </span><span class="k">in</span><span class="w"> </span>ifs,<span class="w"> </span>more<span class="w"> </span>redundant<span class="w"> </span>commas,<span class="w"> </span>better<span class="w"> </span>pkgconfig-depends<span class="o">)</span>
Your<span class="w"> </span>choice?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span><span class="m">2</span>.4<span class="w">    </span><span class="o">(</span>+<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;**&#39;</span><span class="w"> </span>globbing<span class="o">)]</span><span class="w"> </span>
Package<span class="w"> </span>name?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>myproject<span class="o">]</span><span class="w"> </span>
Package<span class="w"> </span>version?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span><span class="m">0</span>.1.0.0<span class="o">]</span><span class="w"> </span>
Please<span class="w"> </span>choose<span class="w"> </span>a<span class="w"> </span>license:
<span class="w"> </span>*<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>NONE
<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>BSD-2-Clause
<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>BSD-3-Clause
<span class="w">   </span><span class="m">4</span><span class="o">)</span><span class="w"> </span>Apache-2.0
<span class="w">   </span><span class="m">5</span><span class="o">)</span><span class="w"> </span>MIT
<span class="w">   </span><span class="m">6</span><span class="o">)</span><span class="w"> </span>MPL-2.0
<span class="w">   </span><span class="m">7</span><span class="o">)</span><span class="w"> </span>ISC
<span class="w">   </span><span class="m">8</span><span class="o">)</span><span class="w"> </span>GPL-2.0-only
<span class="w">   </span><span class="m">9</span><span class="o">)</span><span class="w"> </span>GPL-3.0-only
<span class="w">  </span><span class="m">10</span><span class="o">)</span><span class="w"> </span>LGPL-2.1-only
<span class="w">  </span><span class="m">11</span><span class="o">)</span><span class="w"> </span>LGPL-3.0-only
<span class="w">  </span><span class="m">12</span><span class="o">)</span><span class="w"> </span>AGPL-3.0-only
<span class="w">  </span><span class="m">13</span><span class="o">)</span><span class="w"> </span>GPL-2.0-or-later
<span class="w">  </span><span class="m">14</span><span class="o">)</span><span class="w"> </span>GPL-3.0-or-later
<span class="w">  </span><span class="m">15</span><span class="o">)</span><span class="w"> </span>LGPL-2.1-or-later
<span class="w">  </span><span class="m">16</span><span class="o">)</span><span class="w"> </span>LGPL-3.0-or-later
<span class="w">  </span><span class="m">17</span><span class="o">)</span><span class="w"> </span>AGPL-3.0-or-later
<span class="w">  </span><span class="m">18</span><span class="o">)</span><span class="w"> </span>Other<span class="w"> </span><span class="o">(</span>specify<span class="o">)</span>
Your<span class="w"> </span>choice?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>NONE<span class="o">]</span><span class="w"> </span>
Author<span class="w"> </span>name?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>waste-of-kindergarten<span class="o">]</span><span class="w"> </span>
Maintainer<span class="w"> </span>email?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span><span class="m">2020141461068</span>@stu.scu.edu.cn<span class="o">]</span><span class="w"> </span>
Project<span class="w"> </span>homepage<span class="w"> </span>URL?<span class="w"> </span>
Project<span class="w"> </span>synopsis?<span class="w"> </span>
Project<span class="w"> </span>category:
<span class="w"> </span>*<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>none<span class="o">)</span>
<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>Codec
<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>Concurrency
<span class="w">   </span><span class="m">4</span><span class="o">)</span><span class="w"> </span>Control
<span class="w">   </span><span class="m">5</span><span class="o">)</span><span class="w"> </span>Data
<span class="w">   </span><span class="m">6</span><span class="o">)</span><span class="w"> </span>Database
<span class="w">   </span><span class="m">7</span><span class="o">)</span><span class="w"> </span>Development
<span class="w">   </span><span class="m">8</span><span class="o">)</span><span class="w"> </span>Distribution
<span class="w">   </span><span class="m">9</span><span class="o">)</span><span class="w"> </span>Game
<span class="w">  </span><span class="m">10</span><span class="o">)</span><span class="w"> </span>Graphics
<span class="w">  </span><span class="m">11</span><span class="o">)</span><span class="w"> </span>Language
<span class="w">  </span><span class="m">12</span><span class="o">)</span><span class="w"> </span>Math
<span class="w">  </span><span class="m">13</span><span class="o">)</span><span class="w"> </span>Network
<span class="w">  </span><span class="m">14</span><span class="o">)</span><span class="w"> </span>Sound
<span class="w">  </span><span class="m">15</span><span class="o">)</span><span class="w"> </span>System
<span class="w">  </span><span class="m">16</span><span class="o">)</span><span class="w"> </span>Testing
<span class="w">  </span><span class="m">17</span><span class="o">)</span><span class="w"> </span>Text
<span class="w">  </span><span class="m">18</span><span class="o">)</span><span class="w"> </span>Web
<span class="w">  </span><span class="m">19</span><span class="o">)</span><span class="w"> </span>Other<span class="w"> </span><span class="o">(</span>specify<span class="o">)</span>
Your<span class="w"> </span>choice?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span><span class="o">(</span>none<span class="o">)]</span><span class="w"> </span>
Application<span class="w"> </span><span class="o">(</span>Main.hs<span class="o">)</span><span class="w"> </span>directory:
<span class="w"> </span>*<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>app
<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>src-exe
<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>none<span class="o">)</span>
<span class="w">   </span><span class="m">4</span><span class="o">)</span><span class="w"> </span>Other<span class="w"> </span><span class="o">(</span>specify<span class="o">)</span>
Your<span class="w"> </span>choice?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>app<span class="o">]</span><span class="w"> </span>
What<span class="w"> </span>base<span class="w"> </span>language<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>written<span class="w"> </span><span class="k">in</span>:
<span class="w"> </span>*<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>Haskell2010
<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>Haskell98
<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>Other<span class="w"> </span><span class="o">(</span>specify<span class="o">)</span>
Your<span class="w"> </span>choice?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>Haskell2010<span class="o">]</span><span class="w"> </span>
Add<span class="w"> </span>informative<span class="w"> </span>comments<span class="w"> </span>to<span class="w"> </span>each<span class="w"> </span>field<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>cabal<span class="w"> </span>file<span class="w"> </span><span class="o">(</span>y/n<span class="o">)</span>?<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>n<span class="o">]</span><span class="w"> </span>

Guessing<span class="w"> </span>dependencies...
Generating<span class="w"> </span>CHANGELOG.md...
Generating<span class="w"> </span>app/Main.hs...
Generating<span class="w"> </span>myproject.cabal...

Warning:<span class="w"> </span>no<span class="w"> </span>synopsis<span class="w"> </span>given.<span class="w"> </span>You<span class="w"> </span>should<span class="w"> </span>edit<span class="w"> </span>the<span class="w"> </span>.cabal<span class="w"> </span>file<span class="w"> </span>and<span class="w"> </span>add<span class="w"> </span>one.
You<span class="w"> </span>may<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>edit<span class="w"> </span>the<span class="w"> </span>.cabal<span class="w"> </span>file<span class="w"> </span>and<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>Description<span class="w"> </span>field.
</pre></div>
</div>
<p>完成创建后，我们可以看到<code class="docutils literal notranslate"><span class="pre">myproject</span></code>文件夹中多了如下内容：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tree<span class="w"> </span>--<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>tree
.
├──<span class="w"> </span>app
│<span class="w">   </span>└──<span class="w"> </span>Main.hs
├──<span class="w"> </span>CHANGELOG.md
└──<span class="w"> </span>myproject.cabal

<span class="m">1</span><span class="w"> </span>directory,<span class="w"> </span><span class="m">3</span><span class="w"> </span>files
</pre></div>
</div>
<p>项目文件夹比较简单，只有<code class="docutils literal notranslate"><span class="pre">app</span></code>文件夹，<code class="docutils literal notranslate"><span class="pre">.cabal</span></code>文件以及一个说明文件<code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code>。</p>
<p>我们首先在<code class="docutils literal notranslate"><span class="pre">app</span></code>文件夹中创建一个名为<code class="docutils literal notranslate"><span class="pre">Fac.hs</span></code>的文件，并在内部添加阶乘函数：</p>
<div class="highlight-hs notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Fac.hs</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">Fac</span><span class="w"> </span><span class="p">(</span><span class="nf">factorial</span><span class="p">)</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span>

<span class="nf">factorial</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Integer</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Integer</span><span class="w"> </span>
<span class="nf">factorial</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
<span class="w">                </span><span class="kr">then</span><span class="w"> </span><span class="ne">error</span><span class="w"> </span><span class="s">&quot; x &lt; 0 not allowed&quot;</span>
<span class="w">                </span><span class="kr">else</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="n">x</span>

<span class="nf">fun</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Integer</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Integer</span><span class="w"> </span>
<span class="nf">fun</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="nf">fun</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>这里为了避免频繁地进行条件判断，在<code class="docutils literal notranslate"><span class="pre">factorial</span></code>函数中只进行一次范围判断，对于合法的数字，定义<code class="docutils literal notranslate"><span class="pre">fun</span></code>函数用于正常的阶乘运算。</p>
<p>然后修改<code class="docutils literal notranslate"><span class="pre">Main.hs</span></code>文件如下：</p>
<div class="highlight-hs notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">Main</span><span class="w"> </span><span class="kr">where</span><span class="w"> </span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Fac</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">System.Environment</span><span class="p">(</span><span class="n">getArgs</span><span class="p">)</span>

<span class="nf">main</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span>
<span class="nf">main</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span><span class="w"> </span>
<span class="w">    </span><span class="n">args</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">getArgs</span>
<span class="w">    </span><span class="kr">let</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="p">(</span><span class="n">head</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Integer</span>
<span class="w">    </span><span class="n">print</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">factorial</span><span class="w"> </span><span class="n">num</span>
</pre></div>
</div>
<p>主程序从命令行中读取用户输入的数字参数，并将其转化为整数，最终输出阶乘的结果。</p>
<p>最后，为了让主程序能够探测到<code class="docutils literal notranslate"><span class="pre">Fac</span></code>模块的位置，需要修改<code class="docutils literal notranslate"><span class="pre">.cabal</span></code>文件，将<code class="docutils literal notranslate"><span class="pre">other-modules</span></code>取消注释并添加<code class="docutils literal notranslate"><span class="pre">Fac</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">executable</span> <span class="n">myproject</span>
    <span class="n">main</span><span class="o">-</span><span class="ow">is</span><span class="p">:</span>          <span class="n">Main</span><span class="o">.</span><span class="n">hs</span>

    <span class="o">--</span> <span class="n">Modules</span> <span class="n">included</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">executable</span><span class="p">,</span> <span class="n">other</span> <span class="n">than</span> <span class="n">Main</span><span class="o">.</span>
    <span class="n">other</span><span class="o">-</span><span class="n">modules</span><span class="p">:</span> <span class="n">Fac</span>

<span class="o">...</span>
</pre></div>
</div>
<p>保存完毕后，编译文件并执行。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 编译</span>
$<span class="w"> </span>cabal<span class="w"> </span>build
Build<span class="w"> </span>profile:<span class="w"> </span>-w<span class="w"> </span>ghc-8.6.4<span class="w"> </span>-O1
In<span class="w"> </span>order,<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>built<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>-v<span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>details<span class="o">)</span>:
<span class="w"> </span>-<span class="w"> </span>myproject-0.1.0.0<span class="w"> </span><span class="o">(</span>exe:myproject<span class="o">)</span><span class="w"> </span><span class="o">(</span>first<span class="w"> </span>run<span class="o">)</span>
Preprocessing<span class="w"> </span>executable<span class="w"> </span><span class="s1">&#39;myproject&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>myproject-0.1.0.0..
Building<span class="w"> </span>executable<span class="w"> </span><span class="s1">&#39;myproject&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>myproject-0.1.0.0..
<span class="o">[</span><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span>Compiling<span class="w"> </span>Main<span class="w">             </span><span class="o">(</span><span class="w"> </span>app/Main.hs,<span class="w"> </span>/home/user/myproject/dist-newstyle/build/x86_64-linux/ghc-8.6.4/myproject-0.1.0.0/x/myproject/build/myproject/myproject-tmp/Main.o<span class="w"> </span><span class="o">)</span>
Linking<span class="w"> </span>/home/user/myproject/dist-newstyle/build/x86_64-linux/ghc-8.6.4/myproject-0.1.0.0/x/myproject/build/myproject/myproject<span class="w"> </span>...
$<span class="w"> </span>cabal<span class="w"> </span>run
cabal<span class="w"> </span>run<span class="w"> </span>myproject<span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;5&quot;</span>
Up<span class="w"> </span>to<span class="w"> </span>date
<span class="m">120</span>
</pre></div>
</div>
</section>
<section id="id7">
<h2>项目的打包与安装<a class="headerlink" href="#id7" title="此标题的永久链接"></a></h2>
<p>我们将上一节中的项目从可执行程序更改为库，重新初始化后文件层次如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tree
.
├──<span class="w"> </span>CHANGELOG.md
├──<span class="w"> </span>myproject.cabal
├──<span class="w"> </span>src
│<span class="w">   </span>└──<span class="w"> </span>MyLib.hs
└──<span class="w"> </span><span class="nb">test</span>
<span class="w">    </span>└──<span class="w"> </span>MyLibTest.hs

<span class="m">2</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">4</span><span class="w"> </span>files
</pre></div>
</div>
<p>将<code class="docutils literal notranslate"><span class="pre">MyLib.hs</span></code>更改为<code class="docutils literal notranslate"><span class="pre">Fac.hs</span></code>，并将上一节的内容复制到这个文件中。</p>
<p>接着修改<code class="docutils literal notranslate"><span class="pre">.cabal</span></code>文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">library</span>
    <span class="n">exposed</span><span class="o">-</span><span class="n">modules</span><span class="p">:</span>  <span class="n">Fac</span>
<span class="o">...</span>
</pre></div>
</div>
<p>我们希望在打包前能够测试一下这个包是否能够正常使用，因此还需要修改一下测试文件<code class="docutils literal notranslate"><span class="pre">MyLibTest.hs</span></code>:</p>
<div class="highlight-hs notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">Main</span><span class="w"> </span><span class="p">(</span><span class="nf">main</span><span class="p">)</span><span class="w"> </span><span class="kr">where</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Fac</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Test.HUnit</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">System.Exit</span>

<span class="nf">tests</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Test</span>
<span class="nf">tests</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">TestList</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;Test 1&quot;</span><span class="w"> </span><span class="o">~:</span><span class="w"> </span><span class="n">assertEqual</span><span class="w"> </span><span class="s">&quot;x &gt; 0 ?&quot;</span><span class="w"> </span><span class="mi">120</span><span class="w"> </span><span class="p">(</span><span class="n">factorial</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span>
<span class="w">    </span><span class="s">&quot;Test 2&quot;</span><span class="w"> </span><span class="o">~:</span><span class="w"> </span><span class="n">assertEqual</span><span class="w"> </span><span class="s">&quot;x = 0 ?&quot;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">factorial</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">]</span>

<span class="nf">main</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span>
<span class="nf">main</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">counts</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">runTestTT</span><span class="w"> </span><span class="n">tests</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="kr">then</span><span class="w"> </span><span class="n">exitSuccess</span>
<span class="w">    </span><span class="kr">else</span><span class="w"> </span><span class="n">exitFailure</span>
</pre></div>
</div>
<p>然后修改<code class="docutils literal notranslate"><span class="pre">.cabal</span></code>文件的测试部分：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>...
test-suite myproject-test
    default-language: Haskell2010
    type:             exitcode-stdio-1.0
    hs-source-dirs:   test , src -- 此处添加src，以便Fac可见
    main-is:          MyLibTest.hs
    build-depends:    base ^&gt;=4.12.0.0, HUnit -- 添加额外的HUnit依赖
</pre></div>
</div>
<p>至此，我们就可以执行测试了：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cabal<span class="w"> </span><span class="nb">test</span>
...
Running<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>suites...
Test<span class="w"> </span>suite<span class="w"> </span>myproject-test:<span class="w"> </span>RUNNING...
Test<span class="w"> </span>suite<span class="w"> </span>myproject-test:<span class="w"> </span>PASS
Test<span class="w"> </span>suite<span class="w"> </span>logged<span class="w"> </span>to:
/home/user/myproject/dist-newstyle/build/x86_64-linux/ghc-8.6.4/myproject-0.1.0.0/t/myproject-test/test/myproject-0.1.0.0-myproject-test.log
<span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>suites<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>cases<span class="o">)</span><span class="w"> </span>passed.
</pre></div>
</div>
<p>测试成功，接下来我们就可以将项目进行打包和安装。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cabal<span class="w"> </span>build<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>cabal<span class="w"> </span>run
...
Linking<span class="w"> </span>/home/user/myproject/dist-newstyle/build/x86_64-linux/ghc-8.6.4/myproject-0.1.0.0/t/myproject-test/build/myproject-test/myproject-test<span class="w"> </span>...
Cases:<span class="w"> </span><span class="m">2</span><span class="w">  </span>Tried:<span class="w"> </span><span class="m">2</span><span class="w">  </span>Errors:<span class="w"> </span><span class="m">0</span><span class="w">  </span>Failures:<span class="w"> </span><span class="m">0</span>
<span class="c1"># 创建一个归档</span>
$<span class="w"> </span>cabal<span class="w"> </span>sdist
Wrote<span class="w"> </span>tarball<span class="w"> </span>sdist<span class="w"> </span>to
/home/user/myproject/dist-newstyle/sdist/myproject-0.1.0.0.tar.gz
</pre></div>
</div>
<p>对于本地项目我们可以直接<code class="docutils literal notranslate"><span class="pre">cabal</span> <span class="pre">install</span></code>，对于获得归档文件的用户来说，需要解压归档然后安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tar<span class="w"> </span>-xf<span class="w"> </span>myproject-0.1.0.0.tar.gz
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>myproject-0.1.0.0
$<span class="w"> </span>cabal<span class="w"> </span>install<span class="w"> </span>--lib<span class="w"> </span>
<span class="c1"># 注意这个lib必须要加，否则会被认为安装的是和执行文件</span>
Wrote<span class="w"> </span>tarball<span class="w"> </span>sdist<span class="w"> </span>to
/home/user/myproject/myproject-0.1.0.0/dist-newstyle/sdist/myproject-0.1.0.0.tar.gz
Resolving<span class="w"> </span>dependencies...
Build<span class="w"> </span>profile:<span class="w"> </span>-w<span class="w"> </span>ghc-8.6.4<span class="w"> </span>-O1
In<span class="w"> </span>order,<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>built<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>-v<span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>details<span class="o">)</span>:
<span class="w"> </span>-<span class="w"> </span>myproject-0.1.0.0<span class="w"> </span><span class="o">(</span>lib<span class="o">)</span><span class="w"> </span><span class="o">(</span>requires<span class="w"> </span>build<span class="o">)</span>
Starting<span class="w">     </span>myproject-0.1.0.0<span class="w"> </span><span class="o">(</span>lib<span class="o">)</span>
Building<span class="w">     </span>myproject-0.1.0.0<span class="w"> </span><span class="o">(</span>lib<span class="o">)</span>
Installing<span class="w">   </span>myproject-0.1.0.0<span class="w"> </span><span class="o">(</span>lib<span class="o">)</span>
Completed<span class="w">    </span>myproject-0.1.0.0<span class="w"> </span><span class="o">(</span>lib<span class="o">)</span>
</pre></div>
</div>
<p>至此，<code class="docutils literal notranslate"><span class="pre">myproject</span></code>包已经安装完成，现在可以尝试在GHCi中使用它了。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Prelude&gt;<span class="w"> </span>import<span class="w"> </span>Fac
Prelude&gt;<span class="w"> </span>factorial<span class="w"> </span><span class="m">5</span>
<span class="m">120</span>
Prelude&gt;<span class="w"> </span>factorial<span class="w"> </span><span class="m">0</span>
<span class="m">1</span>
Prelude&gt;<span class="w"> </span>factorial<span class="w"> </span><span class="o">(</span>-1<span class="o">)</span>
***<span class="w"> </span>Exception:<span class="w">  </span>x<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span><span class="w"> </span>not<span class="w"> </span>allowed
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="index.html" class="btn btn-neutral float-left" title="Haskell 工程专题" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../../%E8%B5%84%E6%BA%90.html" class="btn btn-neutral float-right" title="资源" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024, Alfred Xiang.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>